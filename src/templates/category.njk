{% extends "_layout.njk" %}
{% block head %}
{% if categoryLdjson %}
<script type="application/ld+json">
{{ categoryLdjson | dump(2) | safe }}
</script>
{% endif %}
{% endblock %}
{% block content %}
<div class="container">
  <header class="page-header">
    <p class="breadcrumb"><a href="/">Home</a> / {{ category.name }}</p>
    <h1>{{ category.name }}</h1>
    <p>{{ description }}</p>
    {% if lastUpdated %}
    <p class="page-header__meta">Last verified {{ lastUpdated }}</p>
    {% endif %}
  </header>
  <section class="section section--category">
    <div class="section-heading">
      <div>
        <h2 class="section-title">{{ category.name }} AI porn sites</h2>
        <p class="section-subtitle">Sort curated listings of {{ category.name | lower }} tools, apps, and services.</p>
      </div>
      <div class="section-actions">
        <div class="sort-control">
          <label class="sort-control__label" for="sort-order">Sort by</label>
          <select id="sort-order" class="sort-control__select">
            <option value="rank">Editor ranking</option>
            <option value="rating">Highest rating</option>
            <option value="votes">Most votes</option>
            <option value="alphabetical">A–Z</option>
            <option value="recent">Recently verified</option>
          </select>
        </div>
      </div>
    </div>
    <div class="site-grid" id="site-grid">
      {% for site in sites %}
      <article class="site-card site-card--compact" data-slug="{{ site.slug }}" data-categories='{{ (site.categories or []) | dump }}' data-tags='{{ (site.tags or []) | dump }}' data-pricing="{{ site.pricing }}" data-rank="{{ site.rank or loop.index }}" data-rating="{{ site.rating if site.rating is not none else '' }}" data-votes="{{ site.votes if site.votes is not none else '' }}" data-name="{{ site.name }}" data-last-checked="{{ site.lastChecked or '' }}">
        <header class="site-card__header">
          <div class="site-card__meta">
            <span class="site-card__rank">#{{ site.rank or loop.index }}</span>
            <h2><a href="/site/{{ site.slug }}/">{{ site.name }}</a></h2>
          </div>
          <div class="site-card__rating" aria-label="Rating">
            {% if site.rating %}
            <span class="site-card__score">{{ site.rating }}<small>/100</small></span>
            {% else %}
            <span class="site-card__score is-na">N/A</span>
            {% endif %}
          </div>
        </header>
        <p class="site-card__summary">{{ site.summary }}</p>
        <div class="site-card__footer">
          <ul class="pill-list">
            <li class="pill">{{ site.pricing | capitalize }}</li>
            {% for tag in site.tags or [] %}
            <li class="pill pill--muted">{{ tag }}</li>
            {% endfor %}
          </ul>
          <div class="site-card__actions">
            <a class="btn btn-secondary" href="/site/{{ site.slug }}/">Profile</a>
            <a class="btn btn-primary" href="{{ site.website | safe }}" rel="noopener" target="_blank">Visit →</a>
          </div>
        </div>
      </article>
      {% else %}
      <p>No sites indexed for this category yet.</p>
      {% endfor %}
    </div>
  </section>
</div>
{% endblock %}
